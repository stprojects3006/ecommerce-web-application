<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PURELY E-commerce Application - Queue-it Integration Technical Manual</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .section h3 {
            color: #34495e;
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
        }

        .section h4 {
            color: #2c3e50;
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        .flowchart-container {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .flowchart-container h3 {
            margin-bottom: 20px;
            color: #495057;
        }

        .mermaid {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .file-structure {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        .file-structure pre {
            margin: 0;
            white-space: pre-wrap;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .feature-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .feature-card ul {
            margin-left: 20px;
        }

        .feature-card li {
            margin-bottom: 5px;
        }

        .steps-list {
            counter-reset: step-counter;
            list-style: none;
            padding: 0;
        }

        .steps-list li {
            counter-increment: step-counter;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 0 8px 8px 0;
        }

        .steps-list li::before {
            content: counter(step-counter);
            background: #667eea;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }

        .api-endpoint {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .api-endpoint h5 {
            color: #1976d2;
            margin-bottom: 5px;
        }

        .api-endpoint .method {
            background: #1976d2;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .toc {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .toc h3 {
            margin-bottom: 15px;
            color: #495057;
        }

        .toc ul {
            list-style: none;
            padding: 0;
        }

        .toc li {
            margin-bottom: 8px;
        }

        .toc a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }

        .warning {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            color: #721c24;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            color: #155724;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PURELY E-commerce Application</h1>
            <p>Queue-it Integration ‚Äì Technical Manual</p>
        </div>

        <div class="content">
            <div class="toc">
                <h3>üìã Table of Contents</h3>
                <ul>
                    <li><a href="#overview">1. Overview</a></li>
                    <li><a href="#flowchart">2. Queue-it Integration Flow</a></li>
                    <li><a href="#implementation">3. Technical Implementation Steps</a></li>
                    <li><a href="#features">4. Key Features</a></li>
                    <li><a href="#deployment">5. Deployment & Testing</a></li>
                    <li><a href="#references">6. References</a></li>
                </ul>
            </div>

            <div class="section" id="overview">
                <h2>1. Overview</h2>
                <p>This manual documents all changes and steps performed to integrate Queue-it's virtual waiting room into the PURELY e-commerce application, covering both frontend and backend implementations. The integration provides a comprehensive solution for managing high-traffic events and preventing website crashes during peak loads.</p>
                
                <div class="highlight">
                    <strong>üéØ Key Objectives:</strong>
                    <ul>
                        <li>Implement virtual waiting room for high-traffic events</li>
                        <li>Provide fair access to all users during peak loads</li>
                        <li>Prevent website crashes during flash sales and major events</li>
                        <li>Maintain excellent user experience with real-time updates</li>
                    </ul>
                </div>
            </div>

            <div class="section" id="flowchart">
                <h2>2. Queue-it Integration Flow</h2>
                <div class="flowchart-container">
                    <h3>Technical Flow Diagram</h3>
                    <div class="mermaid">
                        flowchart TD
                            A["User visits protected page (e.g. /flash-sale)"]
                            B{"Is Queue-it enabled?"}
                            C{"Does URL match event trigger?"}
                            D["Check queue status via /api/queueit/status/{eventId}"]
                            E{"Is queue active?"}
                            F["Enqueue user via /api/queueit/enqueue"]
                            G{"Redirect to Queue-it or poll position?"}
                            H["Redirect to Queue-it waiting room"]
                            I["Store queue token, start polling"]
                            J["Poll /api/queueit/position/{eventId}"]
                            K{"Position == 0?"}
                            L["Allow access, clear token"]
                            M["Show queue overlay & indicator"]
                            N["Bypass queue (dev only)"]
                            O["Allow access"]
                            P["User accesses page"]

                            A --> B
                            B -- No --> O
                            B -- Yes --> C
                            C -- No --> O
                            C -- Yes --> D
                            D --> E
                            E -- No --> O
                            E -- Yes --> F
                            F --> G
                            G -- Redirect --> H
                            G -- Poll --> I
                            I --> M
                            I --> J
                            J --> K
                            K -- No --> J
                            K -- Yes --> L
                            L --> O
                            N --> O
                            M --> O
                            O --> P
                    </div>
                </div>
            </div>

            <div class="section" id="implementation">
                <h2>3. Technical Implementation Steps</h2>

                <h3>A. Frontend (React) Implementation</h3>

                <h4>1. Configuration Setup</h4>
                <div class="file-structure">
                    <strong>Created:</strong> frontend/src/queueit/queueit-config.js
                    <pre>
// Queue-it Configuration for PURELY E-commerce Application
export const QUEUE_IT_CONFIG = {
  customerId: process.env.REACT_APP_QUEUE_IT_CUSTOMER_ID || 'futuraforge',
  secretKey: process.env.REACT_APP_QUEUE_IT_SECRET_KEY || 'your-secret-key',
  apiKey: process.env.REACT_APP_QUEUE_IT_API_KEY || 'your-api-key',
  
  events: {
    flashSale: {
      eventId: 'flash-sale-2024',
      queueDomain: 'futuraforge.queue-it.net',
      cookieValidityMinute: 20,
      triggers: [
        {
          operator: 'Contains',
          valueToCompare: '/flash-sale',
          urlPart: 'PageUrl',
          validatorType: 'UrlValidator'
        }
      ]
    }
  }
};
                    </pre>
                </div>

                <h4>2. Service Layer Implementation</h4>
                <div class="file-structure">
                    <strong>Created:</strong> frontend/src/queueit/queueit-service.js
                    <pre>
class QueueItService {
  // Initialize Queue-it service
  async initialize() {
    // Check if user is already in queue
    // Check current URL for queue triggers
  }

  // Check if current URL triggers a queue
  async checkQueueTriggers() {
    // Loop through events and check URL patterns
  }

  // Join the queue
  async joinQueue(eventConfig) {
    // Make API call to enqueue user
    // Handle redirect or token response
  }

  // Poll queue position
  startQueuePolling(eventId) {
    // Poll every 5 seconds for position updates
  }
}
                    </pre>
                </div>

                <h4>3. React Context Implementation</h4>
                <div class="file-structure">
                    <strong>Created:</strong> frontend/src/queueit/queueit-context.jsx
                    <pre>
export const QueueItProvider = ({ children }) => {
  const [queueState, setQueueState] = useState({
    status: QUEUE_STATUS.IDLE,
    currentEvent: null,
    queueToken: null,
    error: null,
    position: null,
    estimatedWaitTime: null,
  });

  // Initialize Queue-it service
  // Listen to Queue-it events
  // Provide queue actions
};

export const useQueueIt = () => {
  const context = useContext(QueueItContext);
  if (!context) {
    throw new Error('useQueueIt must be used within a QueueItProvider');
  }
  return context;
};
                    </pre>
                </div>

                <h4>4. UI Components Implementation</h4>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>QueueOverlay Component</h4>
                        <ul>
                            <li>Full-screen overlay for queue experience</li>
                            <li>Real-time position updates</li>
                            <li>Progress bar visualization</li>
                            <li>Estimated wait time display</li>
                            <li>Error handling and recovery</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>QueueIndicator Component</h4>
                        <ul>
                            <li>Header status indicator</li>
                            <li>Queue position display</li>
                            <li>Animated status dots</li>
                            <li>Responsive design</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>Flash Sale Demo Page</h4>
                        <ul>
                            <li>Example implementation</li>
                            <li>Development controls</li>
                            <li>Queue status display</li>
                            <li>Product showcase</li>
                        </ul>
                    </div>
                </div>

                <h4>5. App Integration</h4>
                <div class="file-structure">
                    <strong>Modified:</strong> frontend/src/App.jsx
                    <pre>
import { QueueItProvider } from "./queueit/queueit-context";
import QueueOverlay from "./queueit/components/QueueOverlay";
import QueueIndicator from "./queueit/components/QueueIndicator";

function App() {
  return (
    &lt;QueueItProvider&gt;
      &lt;BrowserRouter&gt;
        &lt;AuthContext.Provider value={{user, toggleUser}}&gt;
          &lt;CartContext.Provider value={{ cart, cartError, ... }}&gt;
            &lt;AppRoutes/&gt;
            &lt;QueueOverlay /&gt;
            &lt;QueueIndicator /&gt;
          &lt;/CartContext.Provider&gt;
        &lt;/AuthContext.Provider&gt;
      &lt;/BrowserRouter&gt;
    &lt;/QueueItProvider&gt;
  )
}
                    </pre>
                </div>

                <h3>B. Backend (Spring Boot API Gateway) Implementation</h3>

                <h4>1. Queue-it Controller</h4>
                <div class="file-structure">
                    <strong>Created:</strong> microservice-backend/api-gateway/src/main/java/com/dharshi/apigateway/controllers/QueueItController.java
                </div>

                <div class="api-endpoint">
                    <h5><span class="method">GET</span> /api/queueit/status/{eventId}</h5>
                    <p>Check if a queue is active for a specific event</p>
                </div>

                <div class="api-endpoint">
                    <h5><span class="method">POST</span> /api/queueit/enqueue</h5>
                    <p>Enqueue a user for a specific event</p>
                </div>

                <div class="api-endpoint">
                    <h5><span class="method">GET</span> /api/queueit/position/{eventId}</h5>
                    <p>Check user's position in queue</p>
                </div>

                <div class="api-endpoint">
                    <h5><span class="method">GET</span> /api/queueit/stats/{eventId}</h5>
                    <p>Get queue statistics</p>
                </div>

                <div class="api-endpoint">
                    <h5><span class="method">GET</span> /api/queueit/health</h5>
                    <p>Health check endpoint for Queue-it integration</p>
                </div>

                <h4>2. Configuration Updates</h4>
                <div class="file-structure">
                    <strong>Modified:</strong> microservice-backend/api-gateway/src/main/resources/application.yml
                    <pre>
# Queue-it Configuration
queueit:
  customer-id: ${QUEUE_IT_CUSTOMER_ID:futuraforge}
  secret-key: ${QUEUE_IT_SECRET_KEY:your-secret-key}
  api-key: ${QUEUE_IT_API_KEY:your-api-key}
  queue-domain: ${QUEUE_IT_QUEUE_DOMAIN:futuraforge.queue-it.net}
  enabled: ${QUEUE_IT_ENABLED:true}
  debug: ${QUEUE_IT_DEBUG:false}
                    </pre>
                </div>

                <h3>C. Documentation Implementation</h3>
                <ol class="steps-list">
                    <li><strong>Created:</strong> technical-notes/QUEUE_IT_INTEGRATION_GUIDE.md - Comprehensive integration guide with setup, API documentation, troubleshooting, and best practices</li>
                    <li><strong>Updated:</strong> technical-notes/README.md - Added reference to Queue-it integration guide</li>
                    <li><strong>Created:</strong> frontend/env.example - Environment variables template for Queue-it configuration</li>
                </ol>
            </div>

            <div class="section" id="features">
                <h2>4. Key Features</h2>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>üéØ Event Types Supported</h4>
                        <ul>
                            <li><strong>Flash Sale Events:</strong> High-traffic limited-time sales</li>
                            <li><strong>Black Friday Events:</strong> Major sales events</li>
                            <li><strong>High Traffic Protection:</strong> General traffic management</li>
                            <li><strong>Checkout Protection:</strong> Payment processing protection</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>üîÑ Queue Experience</h4>
                        <ul>
                            <li><strong>Automatic Detection:</strong> Triggers based on URL patterns</li>
                            <li><strong>Real-time Updates:</strong> Position and wait time updates</li>
                            <li><strong>Progress Visualization:</strong> Animated progress bars</li>
                            <li><strong>Responsive Design:</strong> Works on all devices</li>
                            <li><strong>Error Recovery:</strong> Automatic retry and fallback</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>üõ†Ô∏è Development Features</h4>
                        <ul>
                            <li><strong>Bypass Queue:</strong> Skip queue in development</li>
                            <li><strong>Manual Triggering:</strong> Test queue functionality</li>
                            <li><strong>Debug Logging:</strong> Detailed error tracking</li>
                            <li><strong>Health Monitoring:</strong> Queue service status</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>üîí Security Features</h4>
                        <ul>
                            <li><strong>Secure Token Generation:</strong> Using UUID</li>
                            <li><strong>Token Expiration:</strong> After 20 minutes</li>
                            <li><strong>Rate Limiting:</strong> On API endpoints</li>
                            <li><strong>CORS Configuration:</strong> Secure communication</li>
                            <li><strong>Input Validation:</strong> On all requests</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="section" id="deployment">
                <h2>5. Deployment & Testing</h2>

                <h3>Environment Setup</h3>
                <div class="code-block">
# Set environment variables
export REACT_APP_QUEUE_IT_ENABLED=true
export QUEUE_IT_ENABLED=true
export QUEUE_IT_CUSTOMER_ID=your-customer-id
export QUEUE_IT_SECRET_KEY=your-secret-key
export QUEUE_IT_API_KEY=your-api-key

# Build and deploy
./build.sh
./deploy.sh
                </div>

                <h3>Testing Commands</h3>
                <div class="code-block">
# Test queue health
curl http://localhost:8081/api/queueit/health

# Test queue for flash sale
curl http://localhost:8081/api/queueit/status/flash-sale-2024

# Enqueue a user
curl -X POST http://localhost:8081/api/queueit/enqueue \
  -H "Content-Type: application/json" \
  -d '{
    "eventId": "flash-sale-2024",
    "targetUrl": "http://localhost/flash-sale",
    "userAgent": "Mozilla/5.0...",
    "ipAddress": "127.0.0.1"
  }'
                </div>

                <h3>Manual Queue Triggering</h3>
                <div class="code-block">
// In your React component
import { useQueueActions } from '../queueit/queueit-context';

const { triggerQueue } = useQueueActions();

// Trigger flash sale queue
triggerQueue('flashSale');
                </div>

                <div class="success">
                    <strong>‚úÖ Testing Checklist:</strong>
                    <ul>
                        <li>Queue overlay displays correctly</li>
                        <li>Position updates work</li>
                        <li>Progress bar animates</li>
                        <li>Bypass button works (dev only)</li>
                        <li>Responsive design works</li>
                        <li>Error handling works</li>
                    </ul>
                </div>
            </div>

            <div class="section" id="references">
                <h2>6. References</h2>

                <div class="file-structure">
                    <h4>üìÅ File Structure</h4>
                    <pre>
frontend/src/queueit/
‚îú‚îÄ‚îÄ queueit-config.js          # Configuration and constants
‚îú‚îÄ‚îÄ queueit-service.js         # Queue-it service logic
‚îú‚îÄ‚îÄ queueit-context.jsx        # React context provider
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ QueueOverlay.jsx       # Full-screen queue overlay
    ‚îú‚îÄ‚îÄ QueueOverlay.css       # Overlay styles
    ‚îú‚îÄ‚îÄ QueueIndicator.jsx     # Header queue indicator
    ‚îî‚îÄ‚îÄ QueueIndicator.css     # Indicator styles

frontend/src/pages/flash-sale/
‚îú‚îÄ‚îÄ flash-sale.jsx            # Demo page
‚îî‚îÄ‚îÄ flash-sale.css            # Page styles

microservice-backend/api-gateway/
‚îî‚îÄ‚îÄ src/main/java/com/dharshi/apigateway/controllers/
    ‚îî‚îÄ‚îÄ QueueItController.java # Backend queue endpoints

technical-notes/
‚îú‚îÄ‚îÄ QUEUE_IT_INTEGRATION_GUIDE.md    # Comprehensive guide
‚îú‚îÄ‚îÄ QUEUE_IT_TECHNICAL_MANUAL.html   # This manual
‚îî‚îÄ‚îÄ README.md                         # Updated with Queue-it reference
                    </pre>
                </div>

                <h3>Related Documentation</h3>
                <ul>
                    <li><strong>QUEUE_IT_INTEGRATION_GUIDE.md</strong> - Complete setup, API, troubleshooting, and best practices</li>
                    <li><strong>COMPREHENSIVE_DEPLOYMENT_GUIDE.md</strong> - Full deployment documentation</li>
                    <li><strong>TROUBLESHOOTING_GUIDE.md</strong> - Common issues and solutions</li>
                    <li><strong>SSL_SETUP_GUIDE.md</strong> - SSL certificate configuration</li>
                </ul>

                <div class="warning">
                    <strong>‚ö†Ô∏è Important Notes:</strong>
                    <ul>
                        <li>Replace placeholder credentials with actual Queue-it account details</li>
                        <li>Test thoroughly in development before production deployment</li>
                        <li>Monitor queue performance and adjust settings as needed</li>
                        <li>Keep Queue-it credentials secure and rotate regularly</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <h2>üìã Summary</h2>
                <p>This technical manual provides a complete reference for the Queue-it integration implemented in the PURELY e-commerce application. The integration includes:</p>
                
                <ul>
                    <li><strong>Frontend:</strong> React components, context management, and service layer</li>
                    <li><strong>Backend:</strong> Spring Boot controller with comprehensive API endpoints</li>
                    <li><strong>Configuration:</strong> Environment-based settings for all environments</li>
                    <li><strong>Documentation:</strong> Complete guides and troubleshooting resources</li>
                    <li><strong>Testing:</strong> Comprehensive testing procedures and validation</li>
                </ul>

                <div class="success">
                    <strong>üéâ Integration Status: COMPLETE</strong><br>
                    The Queue-it virtual waiting room is fully integrated and ready for production use. The system will automatically manage high-traffic events, prevent website crashes, and provide a fair queuing experience for all users.
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
    </script>
</body>
</html> 